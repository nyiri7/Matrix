<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Document</title>
    <style>
        h1 {
            text-align: center;
        }
        .card {
            margin-top: 20px;
            padding: 0;
        }
        body{
            background-color:blue;
        }
        .matInput{
            width: 20px;
            padding: 0;
            margin:5px;
            color: black;
            text-align: center;
        }
        .matrix{
            border-left: 1px solid black;
            border-right: 1px solid black;
            padding-left: 3px;
            padding-right: 3px;
            margin-left: 2px;
        }
        .matrixH{
            border-left: 1px solid white;
            border-right: 1px solid white;
            padding-left: 3px;
            padding-right: 3px;
            margin-left: 2px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3"></div>
            <div class="col-md-6 card">
                <h1>Mátrix</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10 card">
                <div class="accordion" id="accordionExample">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                            <h4>
                                Alapadatok
                            </h4>
                        </button>
                        </h2>
                        <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            <div class="row MX" style="border-bottom: 2px solid black;">
                                <div style="width: 10px; font-weight: bold;  border-right: 2px solid black;">
                                    x
                                </div>
                                <input type="text" class="form-control matInput x" onchange="main()" value="-2">
                                <input type="text" class="form-control matInput x" onchange="main()" value="-1">
                                <input type="text" class="form-control matInput x" onchange="main()" value="0">
                                <input type="text" class="form-control matInput x" onchange="main()" value="1">
                                <input type="text" class="form-control matInput x" onchange="main()" value="2">
                            </div>
                            <div class="row MY">
                                <div style="width: 10px; font-weight: bold; border-right: 2px solid black;">
                                    y
                                </div>
                                <input type="text" class="form-control matInput y" onchange="main()" value="2">
                                <input type="text" class="form-control matInput y" onchange="main()" value="2">
                                <input type="text" class="form-control matInput y" onchange="main()" value="4">
                                <input type="text" class="form-control matInput y" onchange="main()" value="3">
                                <input type="text" class="form-control matInput y" onchange="main()" value="1">
                            </div>
                            <div class="row mt-2">
                                <div class="col-md-12">
                                    <input type="text" id="functionInput" class="form-control" placeholder="Függvény" onchange="main()">
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-md-12">
                                    <button class="btn btn-light" onclick="addInput()">+ Add X/Y</button>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10 card" style="padding: 10px;">
                <div class="row">
                    <div class="col-md-6">
                        <div class="row">
                                <h2>
                                    A * A <sup>t</sup>
                                </h2>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="d-flex">
                                    <div id="at2"  style="color: white;"></div>
                                    <div id="a"></div>
                                </div>
                                <div class="d-flex mt-2">
                                    <div id="at">

                                    </div>
                                    <div id="ata"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                                <h2>
                                    A * A <sup>t</sup>
                                </h2>
                        </div>
                        <div class="row">
                                <div class="col-md-12">
                                    <div class="d-flex">
                                        <div id="at3"  style="color: white;"></div>
                                        <div id="y"></div>
                                    </div>
                                    <div class="d-flex mt-2">
                                        <div id="at4">

                                        </div>
                                        <div id="aty">

                                        </div>
                                    </div>
                                </div>
                        </div>
                        <div class="row">
                                <h2>
                                    C
                                </h2>
                        </div>
                        <div class="row">
                                <div class="col-md-12">
                                    <div class="d-flex" style="align-items: center;">
                                        <div id="c" style="align-items: center;"></div>
                                        <div id="b" style="align-items: center;"></div>
                                        =
                                        <div id="y2" style="align-items: center;"></div>
                                    </div>
                                </div>
                        </div>
                        <div class="row">
                                <h2>
                                    Eredmény:
                                </h2>
                        </div>
                        <div class="row">
                                <div class="col-md-12">
                                    <div class="d-flex" style="align-items: center;">
                                        <div id="e">

                                        </div>
                                    </div>
                                </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <canvas id="myChart"></canvas>
                    </div>
                </div>

            </div>
        </div>
        <script>
            function main(){
                var xInputs= document.querySelectorAll('.x');
                var yInputs= document.querySelectorAll('.y');
                var xs=[];
                var ys=[];

                xInputs.forEach(input => {
                        input.value = input.value.replace(/[^0-9\-\.,]/g, '');
                });
                
                yInputs.forEach(input => {
                        input.value = input.value.replace(/[^0-9\-\.,]/g, '');
                });
                xInputs.forEach(input => {
                        var yValue = yInputs[Array.from(xInputs).indexOf(input)].value;
                        if(yValue && yValue != '' && input.value && input.value != '') {
                            xs.push(parseFloat(input.value.replace(',', '.')));
                            ys.push(parseFloat(yValue.replace(',', '.')));
                        }
                });
                req={x: xs, y: ys, f: document.getElementById('functionInput').value};
                if(xs.length>1 && ys.length>1 && document.getElementById('functionInput').value && document.getElementById('functionInput').value != ''){
                fetch('/solve', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(req)
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    function renderMatrix(matrix, title, color, classs) {
                        let html = '';
                        if (title) html += `<b>${title}</b><br>`;
                        html += '<table class="'+classs+'" style="color: '+color+'">';
                        for (let row of matrix) {
                            html += '<tr>';
                            for (let cell of row) {
                                html += `<td>${cell}</td>`;
                            }
                            html += '</tr>';
                        }
                        html += '</table>';
                        return html;
                    }
                    function renderMatrix1(matrix, title, color, classs) {
                        let html = '';
                        if (title) html += `<b>${title}</b><br>`;
                        html += '<table class="'+classs+'" style="color: '+color+'">';
                        for (let row of matrix) {
                            html += '<tr>';
                            html += `<td>${row}</td>`;
                            html += '</tr>';
                        }
                        html += '</table>';
                        return html;
                    }

                    document.getElementById('a').innerHTML = renderMatrix(data.A, 'A', 'black', 'matrix');
                    document.getElementById('at').innerHTML = renderMatrix(data.At, 'A<sup>T</sup>', 'black', 'matrix');
                    document.getElementById('at2').innerHTML = renderMatrix(data.At, 'A<sup>T</sup>A', 'white', 'matrixH');
                    document.getElementById('ata').innerHTML = renderMatrix(data.AtA, 'A<sup>T</sup>*A', 'black', 'matrix');

                    document.getElementById('at3').innerHTML = renderMatrix(data.At, 'A<sup>T</sup>A', 'white', 'matrixH');
                    document.getElementById('at4').innerHTML = renderMatrix(data.At, 'A<sup>T</sup>', 'black', 'matrix');
                    document.getElementById('y').innerHTML = renderMatrix1(data.Y, 'Y', 'black', 'matrix');
                    document.getElementById('aty').innerHTML = renderMatrix1(data.AtY, 'A<sup>T</sup>*Y', 'black', 'matrix');

                    document.getElementById('c').innerHTML = renderMatrix1(data.C, 'C', 'black', 'matrix');
                    document.getElementById('y2').innerHTML = renderMatrix1(data.AtY, "A'Y", 'black', 'matrix');
                    document.getElementById('b').innerHTML = renderMatrix1(data.Ak, 'R', 'black', 'matrix');
                    document.getElementById('e').innerHTML = data.eredmeny;

                    const adat = {
                        datasets: [
                            // ------------------------------------------------------------------
                            // 1. DATASET: Az egyedi pontok (Scatter)
                            // ------------------------------------------------------------------
                            {
                                label: 'Egyedi Adatpontok',
                                data: data.p,
                                backgroundColor: 'rgba(255, 99, 132, 0.8)', // Piros pontok
                                pointRadius: 6,
                                showLine: false, // Ne kösse össze a pontokat
                                order: 2 
                            },

                            // ------------------------------------------------------------------
                            // 2. DATASET: Az egyenes vonal (Line)
                            // ------------------------------------------------------------------
                            {
                                label: 'Trendvonal/Egyenes',
                                type: 'line', // Vonal típus
                                data: data.line,
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 3,
                                pointRadius: 0,
                                tension: 0,
                                order: 1 
                            }
                        ]
                    };

                    const config = {
                        type: 'scatter',
                        data: adat,
                        options: {
                            responsive: true,
                            scales: {
                                x: {
                                    type: 'linear',
                                    position: 'bottom',
                                    title: {
                                        display: true,
                                        text: 'X tengely'
                                    }
                                },
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Y tengely'
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: true
                                },
                                title: {
                                    display: true,
                                    text: 'Pontábra és Különálló Egyenes'
                                }
                            }
                        }
                    };
                    if (window.myChartInstance) {
                        window.myChartInstance.destroy();
                    }
                    const ctx = document.getElementById('myChart').getContext('2d');
                    window.myChartInstance = new Chart(ctx, config);

                })
                .catch((error) => {
                    console.error('Error:', error);
                });}

            }

            function addInput() {
                var X = document.createElement('input');
                X.type = 'text';
                X.className = 'form-control matInput x';
                X.onchange = main;
                var Y = document.createElement('input');
                Y.type = 'text';
                Y.className = 'form-control matInput y';
                Y.onchange = main;

                document.querySelector('.MX').appendChild(X);
                document.querySelector('.MY').appendChild(Y);
            }
        </script>
    </div>
</body>
</html>